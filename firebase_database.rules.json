  {
    "rules": {
      ".read": false,
      ".write": false,
      "users": {
        "$userId": {
          ".read": "auth != null && auth.uid == $userId",
          ".write": "auth != null && auth.uid == $userId",
          "products": {
            ".read": "auth != null && auth.uid == $userId",
            ".write": "auth != null && auth.uid == $userId && (
              (!data.exists() && newData.child('createdBy').val() == auth.uid) ||
              (data.exists() && data.child('createdBy').val() == auth.uid)
            )",
            "$productId": {
              "name": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 120"
              },
              "description": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 500)"
              },
              "price": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "stock": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "minStock": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "supplier": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 100)"
              },
              "category": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 50)"
              },
              "barcode": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 50)"
              },
              "image": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "imageUrl": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "createdAt": {
                ".validate": "newData.isString()"
              },
              "updatedAt": {
                ".validate": "newData.isString()"
              },
              "createdBy": {
                ".validate": "newData.isString() && newData.val() == auth.uid"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "stockHistory": {
            ".read": "auth != null && auth.uid == $userId",
            ".write": "auth != null && auth.uid == $userId",
            "$productId": {
              "$historyId": {
                "productId": {
                  ".validate": "newData.isString()"
                },
                "productName": {
                  ".validate": "newData.isString() && newData.val().length <= 120"
                },
                "oldStock": {
                  ".validate": "newData.isNumber() && newData.val() >= 0"
                },
                "newStock": {
                  ".validate": "newData.isNumber() && newData.val() >= 0"
                },
                "difference": {
                  ".validate": "newData.isNumber()"
                },
                "reason": {
                  ".validate": "newData.isString() && newData.val().length <= 100"
                },
                "notes": {
                  ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 200)"
                },
                "createdAt": {
                  ".validate": "newData.isString()"
                },
                "createdBy": {
                  ".validate": "newData.isString() && newData.val() == auth.uid"
                },
                "$other": {
                  ".validate": false
                }
              }
            }
          },
          "transactions": {
            ".read": "auth != null && auth.uid == $userId",
            ".write": "auth != null && auth.uid == $userId && newData.child('createdBy').val() == auth.uid",
            "$transactionId": {
              "id": {
                ".validate": "newData.isString()"
              },
              "items": {
                "$itemId": {
                  "productId": {
                    ".validate": "newData.isString()"
                  },
                  "productName": {
                    ".validate": "newData.isString() && newData.val().length <= 120"
                  },
                  "quantity": {
                    ".validate": "newData.isNumber() && newData.val() > 0"
                  },
                  "price": {
                    ".validate": "newData.isNumber() && newData.val() >= 0"
                  },
                  "subtotal": {
                    ".validate": "newData.isNumber() && newData.val() >= 0"
                  },
                  "$other": {
                    ".validate": false
                  }
                }
              },
              "subtotal": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "tax": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "total": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "discount": {
                ".validate": "!newData.exists() || (newData.isNumber() && newData.val() >= 0)"
              },
              "paymentMethod": {
                ".validate": "newData.isString() && newData.val().length <= 50"
              },
              "cashAmount": {
                ".validate": "!newData.exists() || (newData.isNumber() && newData.val() >= 0)"
              },
              "change": {
                ".validate": "!newData.exists() || (newData.isNumber() && newData.val() >= 0)"
              },
              "customerId": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "customerName": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "customerNameEncrypted": {
                ".validate": "!newData.exists() || newData.isBoolean()"
              },
              "status": {
                ".validate": "newData.isString() && (newData.val() == 'Selesai' || newData.val() == 'Dibatalkan')"
              },
              "createdAt": {
                ".validate": "newData.isString()"
              },
              "cancelledAt": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "cancelledBy": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val() == auth.uid)"
              },
              "updatedAt": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "createdBy": {
                ".validate": "newData.isString() && newData.val() == auth.uid"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "customers": {
            ".read": "auth != null && auth.uid == $userId",
            ".write": "auth != null && auth.uid == $userId && (
              (!data.exists() && newData.child('createdBy').val() == auth.uid) ||
              (data.exists() && data.child('createdBy').val() == auth.uid)
            )",
            "$customerId": {
              "id": {
                ".validate": "newData.isString()"
              },
              "name": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
              },
              "phone": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 20)"
              },
              "email": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 100)"
              },
              "address": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 200)"
              },
              "transactionCount": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "totalSpent": {
                ".validate": "newData.isNumber() && newData.val() >= 0"
              },
              "notes": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 500)"
              },
              "createdAt": {
                ".validate": "newData.isString()"
              },
              "lastTransaction": {
                ".validate": "newData.isString()"
              },
              "updatedAt": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "createdBy": {
                ".validate": "newData.isString() && newData.val() == auth.uid"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "notifications": {
            ".read": "auth != null && auth.uid == $userId",
            ".write": "auth != null && auth.uid == $userId",
            "$notificationId": {
              "id": {
                ".validate": "newData.isString()"
              },
              "title": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
              },
              "message": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 500"
              },
              "type": {
                ".validate": "newData.isString() && newData.val().length <= 50"
              },
              "isRead": {
                ".validate": "newData.isBoolean()"
              },
              "createdAt": {
                ".validate": "newData.isString()"
              },
              "data": {
                ".validate": "!newData.exists() || newData.hasChildren()"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "auditLogs": {
            ".read": "auth != null && auth.uid == $userId",
            ".write": "auth != null && auth.uid == $userId && newData.child('userId').val() == auth.uid",
            "$logId": {
              "action": {
                ".validate": "newData.isString() && newData.val().length <= 50"
              },
              "details": {
                ".validate": "newData.hasChildren()"
              },
              "timestamp": {
                ".validate": "newData.isString()"
              },
              "userId": {
                ".validate": "newData.isString() && newData.val() == auth.uid"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "withdrawals": {
            ".read": "auth != null && auth.uid == $userId",
            ".write": "auth != null && auth.uid == $userId",
            "$withdrawalId": {
              "id": {
                ".validate": "newData.isString()"
              },
              "amount": {
                ".validate": "newData.isNumber() && newData.val() > 0"
              },
              "bankName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
              },
              "accountNumber": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 50"
              },
              "accountHolderName": {
                ".validate": "newData.isString() && newData.val().length > 0 && newData.val().length <= 100"
              },
              "status": {
                ".validate": "newData.isString() && (newData.val() == 'pending' || newData.val() == 'processing' || newData.val() == 'completed' || newData.val() == 'rejected')"
              },
              "notes": {
                ".validate": "!newData.exists() || (newData.isString() && newData.val().length <= 500)"
              },
              "createdAt": {
                ".validate": "newData.isString()"
              },
              "updatedAt": {
                ".validate": "!newData.exists() || newData.isString()"
              },
              "createdBy": {
                ".validate": "newData.isString() && newData.val() == auth.uid"
              },
              "$other": {
                ".validate": false
              }
            }
          },
          "$other": {
            ".validate": false
          }
        }
      }
    }
  }
